{% extends "base.html" %}
{% load high_health_helpers %}
{% load humanize %}
{% load static %}

{% block content %}
<div class="container pt-3">
  <div class="row">
    <div class="col-sm">
      <h1>High Health ({{ school_level.display_name }})</h1>
    </div>
    <div class="col-sm-3 text-right">
      <button type="button" onclick="openNav()" class="btn btn-warning btn-circle hh-info" data-toggle="popover"
        data-placement="bottom" title="High Health Goals" data-trigger="hover"
        data-content='{% include "_hh_legend.html" %}'>
        <i class="fas fa-info"></i>
      </button>
    </div>
  </div>

</div>

<div class="col-sm-10 offset-sm-1">
  <table class="table table-hover mt-3">
    <thead>
      <tr class="small text-center">
        <th>EQ</th>
        <th>Metric</th>
        <th>Updated</th>
        {% for school in schools %}
        <th>{{ school }}</th>
        {% endfor %}
      </tr>
    </thead>
    <tbody>
      {% for metric in metrics %}
      <tr>
        <td class="text-center eq" data-toggle="popover" data-trigger="hover"
          title="{{ metric.metric.essential_question }}"
          data-content="{{ metric.metric.essential_question.description }}">
          {{ metric.metric.essential_question }}
        </td>
        <td>
          <a href="{% if metric.metric.report %}{% url "report" metric.metric.report.id %}{% endif %}">
            {{ metric.metric }}
          </a>
          <i class="fas fa-info-circle text-primary pl-2 metric-def" data-toggle="popover" data-trigger="hover"
            title="{{ metric.metric }}" data-content="{{ metric.metric.definition }}"></i>
        </td>
        <td class="text-center">
          <span class="small text-muted">
            {{ metric.last_updated|naturalday }}
          </span>
        </td>
        {% for measure in metric.measures %}
        {% if measure.value is None %}
        <td class="text-center">
          <span class="text-muted">
            N/A
          </span>
        </td>
        {% else %}
        <td class="text-center">
          {% with "modal_"|addstr:measure.metric.id|addstr:"_"|addstr:measure.school.id as modal_id %}
          {% with "chart_"|addstr:measure.metric.id|addstr:"_"|addstr:measure.school.id as chart_id %}
          <span data-toggle="modal" data-target="#{{ modal_id }}" class="hh_value text-{{ measure|goal_format }}"
            data-metric-id="{{ measure.metric.id }}" data-school-id="{{ measure.school.id }}">
            {{ measure.value|stringformat:'d' }}%
          </span>
          {% include "_chart_modal.html" with title=measure.school  modal_id=modal_id chart_id=chart_id last_updated=measure.date %}
          {% endwith %}
          {% endwith %}
        </td>
        {% endif %}
        {% endfor %}
      </tr>
      {% endfor %}
    </tbody>
  </table>
</div>

{% endblock %}

{% block scripts %}
<script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/2.8.0/Chart.bundle.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/chartjs-plugin-annotation/0.5.7/chartjs-plugin-annotation.js">
</script>
<script src="{% static "js/hh_popover.js" %}"></script>
<script src="{% static "js/hh_chart_modal.js" %}"></script>

{% endblock %}